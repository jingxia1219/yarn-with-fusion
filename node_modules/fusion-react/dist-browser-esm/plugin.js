/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * 
 */
import * as React from 'react';
import { createPlugin } from 'fusion-core';
import Provider from './provider'; // eslint-disable-next-line

export default {
  create: (name, plugin, provider) => {
    let originalMiddleware = plugin.middleware;
    const ProviderComponent = provider || Provider.create(name);

    plugin.middleware = (deps, provides) => {
      let nextMiddleware = originalMiddleware && originalMiddleware(deps, provides);

      const mw = function (ctx, next) {
        if (ctx.element) {
          ctx.element = /*#__PURE__*/React.createElement(ProviderComponent, {
            provides,
            ctx
          }, ctx.element);
        }

        if (nextMiddleware) {
          return nextMiddleware(ctx, next);
        }

        return next();
      };

      return mw;
    };

    return createPlugin(plugin);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wbHVnaW4uanMiXSwibmFtZXMiOlsiUmVhY3QiLCJjcmVhdGVQbHVnaW4iLCJQcm92aWRlciIsImNyZWF0ZSIsIm5hbWUiLCJwbHVnaW4iLCJwcm92aWRlciIsIm9yaWdpbmFsTWlkZGxld2FyZSIsIm1pZGRsZXdhcmUiLCJQcm92aWRlckNvbXBvbmVudCIsImRlcHMiLCJwcm92aWRlcyIsIm5leHRNaWRkbGV3YXJlIiwibXciLCJjdHgiLCJuZXh0IiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsT0FBTyxLQUFLQSxLQUFaLE1BQXVCLE9BQXZCO0FBRUEsU0FBUUMsWUFBUixRQUEyQixhQUEzQjtBQUdBLE9BQU9DLFFBQVAsTUFBcUIsWUFBckIsQyxDQUVBOztBQU1BLGVBQWU7QUFDYkMsRUFBQUEsTUFBTSxFQUFFLENBQ05DLElBRE0sRUFHTkMsTUFITSxFQU1OQyxRQU5NLEtBTzRCO0FBQ2xDLFFBQUlDLGtCQUFrQixHQUFHRixNQUFNLENBQUNHLFVBQWhDO0FBQ0EsVUFBTUMsaUJBQWlCLEdBQUdILFFBQVEsSUFBSUosUUFBUSxDQUFDQyxNQUFULENBQWdCQyxJQUFoQixDQUF0Qzs7QUFDQUMsSUFBQUEsTUFBTSxDQUFDRyxVQUFQLEdBQW9CLENBQUNFLElBQUQsRUFBVUMsUUFBVixLQUEwQjtBQUM1QyxVQUFJQyxjQUFjLEdBQ2hCTCxrQkFBa0IsSUFBSUEsa0JBQWtCLENBQUNHLElBQUQsRUFBT0MsUUFBUCxDQUQxQzs7QUFFQSxZQUFNRSxFQUFjLEdBQUcsVUFBVUMsR0FBVixFQUFlQyxJQUFmLEVBQXFCO0FBQzFDLFlBQUlELEdBQUcsQ0FBQ0UsT0FBUixFQUFpQjtBQUNmRixVQUFBQSxHQUFHLENBQUNFLE9BQUosZ0JBQWNoQixLQUFLLENBQUNpQixhQUFOLENBQ1pSLGlCQURZLEVBRVo7QUFBQ0UsWUFBQUEsUUFBRDtBQUFXRyxZQUFBQTtBQUFYLFdBRlksRUFHWkEsR0FBRyxDQUFDRSxPQUhRLENBQWQ7QUFLRDs7QUFDRCxZQUFJSixjQUFKLEVBQW9CO0FBQ2xCLGlCQUFPQSxjQUFjLENBQUNFLEdBQUQsRUFBTUMsSUFBTixDQUFyQjtBQUNEOztBQUNELGVBQU9BLElBQUksRUFBWDtBQUNELE9BWkQ7O0FBYUEsYUFBT0YsRUFBUDtBQUNELEtBakJEOztBQWtCQSxXQUFPWixZQUFZLENBQUVJLE1BQUYsQ0FBbkI7QUFDRDtBQTlCWSxDQUFmIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQge2NyZWF0ZVBsdWdpbn0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuaW1wb3J0IHR5cGUge0Z1c2lvblBsdWdpbiwgTWlkZGxld2FyZX0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuXG5pbXBvcnQgUHJvdmlkZXIgZnJvbSAnLi9wcm92aWRlcic7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxudHlwZSBGdXNpb25QbHVnaW5Ob0hpZGRlbjxURGVwcywgVFNlcnZpY2U+ID0gJERpZmY8XG4gIEZ1c2lvblBsdWdpbjxURGVwcywgVFNlcnZpY2U+LFxuICB7X19wbHVnaW5fXzogYm9vbGVhbiwgc3RhY2s6IHN0cmluZ31cbj47XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgY3JlYXRlOiA8VERlcHM6ICosIFRTZXJ2aWNlOiAqPihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgcGx1Z2luOlxuICAgICAgfCBGdXNpb25QbHVnaW5Ob0hpZGRlbjxURGVwcywgVFNlcnZpY2U+XG4gICAgICB8IEZ1c2lvblBsdWdpbjxURGVwcywgVFNlcnZpY2U+LFxuICAgIHByb3ZpZGVyPzogUmVhY3QuQ29tcG9uZW50VHlwZTwqPlxuICApOiBGdXNpb25QbHVnaW48VERlcHMsIFRTZXJ2aWNlPiA9PiB7XG4gICAgbGV0IG9yaWdpbmFsTWlkZGxld2FyZSA9IHBsdWdpbi5taWRkbGV3YXJlO1xuICAgIGNvbnN0IFByb3ZpZGVyQ29tcG9uZW50ID0gcHJvdmlkZXIgfHwgUHJvdmlkZXIuY3JlYXRlKG5hbWUpO1xuICAgIHBsdWdpbi5taWRkbGV3YXJlID0gKGRlcHM6ICosIHByb3ZpZGVzOiAqKSA9PiB7XG4gICAgICBsZXQgbmV4dE1pZGRsZXdhcmUgPVxuICAgICAgICBvcmlnaW5hbE1pZGRsZXdhcmUgJiYgb3JpZ2luYWxNaWRkbGV3YXJlKGRlcHMsIHByb3ZpZGVzKTtcbiAgICAgIGNvbnN0IG13OiBNaWRkbGV3YXJlID0gZnVuY3Rpb24gKGN0eCwgbmV4dCkge1xuICAgICAgICBpZiAoY3R4LmVsZW1lbnQpIHtcbiAgICAgICAgICBjdHguZWxlbWVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBQcm92aWRlckNvbXBvbmVudCxcbiAgICAgICAgICAgIHtwcm92aWRlcywgY3R4fSxcbiAgICAgICAgICAgIGN0eC5lbGVtZW50XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV4dE1pZGRsZXdhcmUpIHtcbiAgICAgICAgICByZXR1cm4gbmV4dE1pZGRsZXdhcmUoY3R4LCBuZXh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtdztcbiAgICB9O1xuICAgIHJldHVybiBjcmVhdGVQbHVnaW4oKHBsdWdpbjogYW55KSk7XG4gIH0sXG59O1xuIl19