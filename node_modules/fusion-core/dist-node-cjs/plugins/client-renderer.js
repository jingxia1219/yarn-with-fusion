"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createClientRenderPlugin;

/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * 
 */
function createClientRenderPlugin(app) {
  return function clientRenderPlugin({
    render
  }) {
    return function renderer(ctx, next) {
      app.renderSetupCtx = ctx; // Element wrappers should be added in *reverse* topological order so that
      // the resulting element tree is in topological order during renders.
      // For example, if plugin B depends on plugin A, the tree should be:
      // <AProvider>
      //   <BProvider>{root}</BProvider>
      // </APRovider>
      // In this case, B provider can depend on the context of A provider.

      for (var i = app.renderSetup.length - 1; i >= 0; i--) {
        const wrapper = app.renderSetup[i];
        const result = wrapper(ctx.element);

        if (result !== void 0) {
          ctx.element = result;
        }
      }

      app.renderSetupCtx = void 0;
      const rendered = render(ctx.element, ctx);

      if (rendered instanceof Promise) {
        return rendered.then(r => {
          ctx.rendered = r;
          return next();
        });
      } else {
        ctx.rendered = rendered;
        return next();
      }
    };
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wbHVnaW5zL2NsaWVudC1yZW5kZXJlci5qcyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnRSZW5kZXJQbHVnaW4iLCJhcHAiLCJjbGllbnRSZW5kZXJQbHVnaW4iLCJyZW5kZXIiLCJyZW5kZXJlciIsImN0eCIsIm5leHQiLCJyZW5kZXJTZXR1cEN0eCIsImkiLCJyZW5kZXJTZXR1cCIsImxlbmd0aCIsIndyYXBwZXIiLCJyZXN1bHQiLCJlbGVtZW50IiwicmVuZGVyZWQiLCJQcm9taXNlIiwidGhlbiIsInIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVlLFNBQVNBLHdCQUFULENBQWtDQyxHQUFsQyxFQUF1QztBQUNwRCxTQUFPLFNBQVNDLGtCQUFULENBQTRCO0FBQUNDLElBQUFBO0FBQUQsR0FBNUIsRUFBc0M7QUFDM0MsV0FBTyxTQUFTQyxRQUFULENBQWtCQyxHQUFsQixFQUF1QkMsSUFBdkIsRUFBNkI7QUFDbENMLE1BQUFBLEdBQUcsQ0FBQ00sY0FBSixHQUFxQkYsR0FBckIsQ0FEa0MsQ0FFbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0EsV0FBSyxJQUFJRyxDQUFDLEdBQUdQLEdBQUcsQ0FBQ1EsV0FBSixDQUFnQkMsTUFBaEIsR0FBeUIsQ0FBdEMsRUFBeUNGLENBQUMsSUFBSSxDQUE5QyxFQUFpREEsQ0FBQyxFQUFsRCxFQUFzRDtBQUNwRCxjQUFNRyxPQUFPLEdBQUdWLEdBQUcsQ0FBQ1EsV0FBSixDQUFnQkQsQ0FBaEIsQ0FBaEI7QUFDQSxjQUFNSSxNQUFNLEdBQUdELE9BQU8sQ0FBQ04sR0FBRyxDQUFDUSxPQUFMLENBQXRCOztBQUNBLFlBQUlELE1BQU0sS0FBSyxLQUFLLENBQXBCLEVBQXVCO0FBQ3JCUCxVQUFBQSxHQUFHLENBQUNRLE9BQUosR0FBY0QsTUFBZDtBQUNEO0FBQ0Y7O0FBQ0RYLE1BQUFBLEdBQUcsQ0FBQ00sY0FBSixHQUFxQixLQUFLLENBQTFCO0FBRUEsWUFBTU8sUUFBUSxHQUFHWCxNQUFNLENBQUNFLEdBQUcsQ0FBQ1EsT0FBTCxFQUFjUixHQUFkLENBQXZCOztBQUNBLFVBQUlTLFFBQVEsWUFBWUMsT0FBeEIsRUFBaUM7QUFDL0IsZUFBT0QsUUFBUSxDQUFDRSxJQUFULENBQWVDLENBQUQsSUFBTztBQUMxQlosVUFBQUEsR0FBRyxDQUFDUyxRQUFKLEdBQWVHLENBQWY7QUFDQSxpQkFBT1gsSUFBSSxFQUFYO0FBQ0QsU0FITSxDQUFQO0FBSUQsT0FMRCxNQUtPO0FBQ0xELFFBQUFBLEdBQUcsQ0FBQ1MsUUFBSixHQUFlQSxRQUFmO0FBQ0EsZUFBT1IsSUFBSSxFQUFYO0FBQ0Q7QUFDRixLQTVCRDtBQTZCRCxHQTlCRDtBQStCRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBDb3B5cmlnaHQgKGMpIDIwMTggVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAbm9mbG93XG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlQ2xpZW50UmVuZGVyUGx1Z2luKGFwcCkge1xuICByZXR1cm4gZnVuY3Rpb24gY2xpZW50UmVuZGVyUGx1Z2luKHtyZW5kZXJ9KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHJlbmRlcmVyKGN0eCwgbmV4dCkge1xuICAgICAgYXBwLnJlbmRlclNldHVwQ3R4ID0gY3R4O1xuICAgICAgLy8gRWxlbWVudCB3cmFwcGVycyBzaG91bGQgYmUgYWRkZWQgaW4gKnJldmVyc2UqIHRvcG9sb2dpY2FsIG9yZGVyIHNvIHRoYXRcbiAgICAgIC8vIHRoZSByZXN1bHRpbmcgZWxlbWVudCB0cmVlIGlzIGluIHRvcG9sb2dpY2FsIG9yZGVyIGR1cmluZyByZW5kZXJzLlxuICAgICAgLy8gRm9yIGV4YW1wbGUsIGlmIHBsdWdpbiBCIGRlcGVuZHMgb24gcGx1Z2luIEEsIHRoZSB0cmVlIHNob3VsZCBiZTpcbiAgICAgIC8vIDxBUHJvdmlkZXI+XG4gICAgICAvLyAgIDxCUHJvdmlkZXI+e3Jvb3R9PC9CUHJvdmlkZXI+XG4gICAgICAvLyA8L0FQUm92aWRlcj5cbiAgICAgIC8vIEluIHRoaXMgY2FzZSwgQiBwcm92aWRlciBjYW4gZGVwZW5kIG9uIHRoZSBjb250ZXh0IG9mIEEgcHJvdmlkZXIuXG4gICAgICBmb3IgKHZhciBpID0gYXBwLnJlbmRlclNldHVwLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSBhcHAucmVuZGVyU2V0dXBbaV07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHdyYXBwZXIoY3R4LmVsZW1lbnQpO1xuICAgICAgICBpZiAocmVzdWx0ICE9PSB2b2lkIDApIHtcbiAgICAgICAgICBjdHguZWxlbWVudCA9IHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXBwLnJlbmRlclNldHVwQ3R4ID0gdm9pZCAwO1xuXG4gICAgICBjb25zdCByZW5kZXJlZCA9IHJlbmRlcihjdHguZWxlbWVudCwgY3R4KTtcbiAgICAgIGlmIChyZW5kZXJlZCBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlcmVkLnRoZW4oKHIpID0+IHtcbiAgICAgICAgICBjdHgucmVuZGVyZWQgPSByO1xuICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3R4LnJlbmRlcmVkID0gcmVuZGVyZWQ7XG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cbiJdfQ==