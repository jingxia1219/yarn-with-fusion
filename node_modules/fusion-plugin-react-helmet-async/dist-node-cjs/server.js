"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _fusionCore = require("fusion-core");

var _reactHelmetAsync = require("react-helmet-async");

var _jsxRuntime = require("react/jsx-runtime");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * 
 */
const keys = ['meta', 'link', 'style', 'base', 'noscript', 'script'];
const plugin = true && (0, _fusionCore.createPlugin)({
  middleware: () => {
    return async (ctx, next) => {
      if (!ctx.element) {
        return next();
      }

      const helmetContext = {};
      ctx.element = /*#__PURE__*/(0, _jsxRuntime.jsx)(_reactHelmetAsync.HelmetProvider, {
        context: helmetContext,
        children: ctx.element
      });
      await next();
      const {
        helmet
      } = helmetContext;

      if (helmet) {
        ctx.template.title = (0, _fusionCore.dangerouslySetHTML)(helmet.title.toString().replace('</title>', '').replace(/^<title.*>/, ''));
        keys.forEach(key => {
          ctx.template.head.push((0, _fusionCore.dangerouslySetHTML)(helmet[key].toString()));
        });
        Object.assign(ctx.template.htmlAttrs, helmet.htmlAttributes.toComponent());
      }
    };
  }
});
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9zZXJ2ZXIuanMiXSwibmFtZXMiOlsia2V5cyIsInBsdWdpbiIsIm1pZGRsZXdhcmUiLCJjdHgiLCJuZXh0IiwiZWxlbWVudCIsImhlbG1ldENvbnRleHQiLCJoZWxtZXQiLCJ0ZW1wbGF0ZSIsInRpdGxlIiwidG9TdHJpbmciLCJyZXBsYWNlIiwiZm9yRWFjaCIsImtleSIsImhlYWQiLCJwdXNoIiwiT2JqZWN0IiwiYXNzaWduIiwiaHRtbEF0dHJzIiwiaHRtbEF0dHJpYnV0ZXMiLCJ0b0NvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVFBOztBQUNBOztBQUNBOzs7Ozs7QUFWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBLE1BQU1BLElBQUksR0FBRyxDQUFDLE1BQUQsRUFBUyxNQUFULEVBQWlCLE9BQWpCLEVBQTBCLE1BQTFCLEVBQWtDLFVBQWxDLEVBQThDLFFBQTlDLENBQWI7QUFFQSxNQUFNQyxNQUFNLEdBQ1YsUUFDQSw4QkFBYTtBQUNYQyxFQUFBQSxVQUFVLEVBQUUsTUFBTTtBQUNoQixXQUFPLE9BQU9DLEdBQVAsRUFBWUMsSUFBWixLQUFxQjtBQUMxQixVQUFJLENBQUNELEdBQUcsQ0FBQ0UsT0FBVCxFQUFrQjtBQUNoQixlQUFPRCxJQUFJLEVBQVg7QUFDRDs7QUFDRCxZQUFNRSxhQUFhLEdBQUcsRUFBdEI7QUFDQUgsTUFBQUEsR0FBRyxDQUFDRSxPQUFKLGdCQUNFLHFCQUFDLGdDQUFEO0FBQWdCLFFBQUEsT0FBTyxFQUFFQyxhQUF6QjtBQUFBLGtCQUF5Q0gsR0FBRyxDQUFDRTtBQUE3QyxRQURGO0FBR0EsWUFBTUQsSUFBSSxFQUFWO0FBQ0EsWUFBTTtBQUFDRyxRQUFBQTtBQUFELFVBQVdELGFBQWpCOztBQUNBLFVBQUlDLE1BQUosRUFBWTtBQUNWSixRQUFBQSxHQUFHLENBQUNLLFFBQUosQ0FBYUMsS0FBYixHQUFxQixvQ0FDbkJGLE1BQU0sQ0FBQ0UsS0FBUCxDQUNHQyxRQURILEdBRUdDLE9BRkgsQ0FFVyxVQUZYLEVBRXVCLEVBRnZCLEVBR0dBLE9BSEgsQ0FHVyxZQUhYLEVBR3lCLEVBSHpCLENBRG1CLENBQXJCO0FBTUFYLFFBQUFBLElBQUksQ0FBQ1ksT0FBTCxDQUFjQyxHQUFELElBQVM7QUFDcEJWLFVBQUFBLEdBQUcsQ0FBQ0ssUUFBSixDQUFhTSxJQUFiLENBQWtCQyxJQUFsQixDQUF1QixvQ0FBbUJSLE1BQU0sQ0FBQ00sR0FBRCxDQUFOLENBQVlILFFBQVosRUFBbkIsQ0FBdkI7QUFDRCxTQUZEO0FBR0FNLFFBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUNFZCxHQUFHLENBQUNLLFFBQUosQ0FBYVUsU0FEZixFQUVFWCxNQUFNLENBQUNZLGNBQVAsQ0FBc0JDLFdBQXRCLEVBRkY7QUFJRDtBQUNGLEtBekJEO0FBMEJEO0FBNUJVLENBQWIsQ0FGRjtlQWlDaUJuQixNIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7Y3JlYXRlUGx1Z2luLCBkYW5nZXJvdXNseVNldEhUTUx9IGZyb20gJ2Z1c2lvbi1jb3JlJztcbmltcG9ydCB7SGVsbWV0UHJvdmlkZXJ9IGZyb20gJ3JlYWN0LWhlbG1ldC1hc3luYyc7XG5cbmltcG9ydCB0eXBlIHtGdXNpb25QbHVnaW59IGZyb20gJ2Z1c2lvbi1jb3JlJztcblxuY29uc3Qga2V5cyA9IFsnbWV0YScsICdsaW5rJywgJ3N0eWxlJywgJ2Jhc2UnLCAnbm9zY3JpcHQnLCAnc2NyaXB0J107XG5cbmNvbnN0IHBsdWdpbiA9XG4gIF9fTk9ERV9fICYmXG4gIGNyZWF0ZVBsdWdpbih7XG4gICAgbWlkZGxld2FyZTogKCkgPT4ge1xuICAgICAgcmV0dXJuIGFzeW5jIChjdHgsIG5leHQpID0+IHtcbiAgICAgICAgaWYgKCFjdHguZWxlbWVudCkge1xuICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVsbWV0Q29udGV4dCA9IHt9O1xuICAgICAgICBjdHguZWxlbWVudCA9IChcbiAgICAgICAgICA8SGVsbWV0UHJvdmlkZXIgY29udGV4dD17aGVsbWV0Q29udGV4dH0+e2N0eC5lbGVtZW50fTwvSGVsbWV0UHJvdmlkZXI+XG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IG5leHQoKTtcbiAgICAgICAgY29uc3Qge2hlbG1ldH0gPSBoZWxtZXRDb250ZXh0O1xuICAgICAgICBpZiAoaGVsbWV0KSB7XG4gICAgICAgICAgY3R4LnRlbXBsYXRlLnRpdGxlID0gZGFuZ2Vyb3VzbHlTZXRIVE1MKFxuICAgICAgICAgICAgaGVsbWV0LnRpdGxlXG4gICAgICAgICAgICAgIC50b1N0cmluZygpXG4gICAgICAgICAgICAgIC5yZXBsYWNlKCc8L3RpdGxlPicsICcnKVxuICAgICAgICAgICAgICAucmVwbGFjZSgvXjx0aXRsZS4qPi8sICcnKVxuICAgICAgICAgICk7XG4gICAgICAgICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGN0eC50ZW1wbGF0ZS5oZWFkLnB1c2goZGFuZ2Vyb3VzbHlTZXRIVE1MKGhlbG1ldFtrZXldLnRvU3RyaW5nKCkpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgICAgY3R4LnRlbXBsYXRlLmh0bWxBdHRycyxcbiAgICAgICAgICAgIGhlbG1ldC5odG1sQXR0cmlidXRlcy50b0NvbXBvbmVudCgpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICB9KTtcblxuZXhwb3J0IGRlZmF1bHQgKChwbHVnaW46IGFueSk6IEZ1c2lvblBsdWdpbjx2b2lkLCB2b2lkPik7XG4iXX0=