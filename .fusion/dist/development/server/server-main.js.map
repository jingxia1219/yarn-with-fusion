{"version":3,"file":"server-main.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;;AACA;;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AAGA;AACA;AACA;AAFA;AADA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;;AACA;AAGA;AACA;;AAEA;;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAGA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;;;;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AACA;;;AAEA;AACA;AACA;AACA;AAFA;AAIA;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AACA;AACA;AACA;AACA;;AAGA;;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;AACA;AACA;AAIA;;AAEA;AAGA;AACA;AACA;AACA;AACA;;AAGA;AAEA;AACA;AAXA;AAeA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AAtCA;AAyCA;;;;;;;;;;;;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AACA;AAAA;AAAA;AAEA;;;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAGA;;AAEA;;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AAPA;AASA;AAXA;;AADA;;;;;;;;;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;AADA;;;;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA;AAEA;AASA;;AAMA;AACA;AACA;AACA;;AAEA;;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AAIA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AAGA;;AAEA;;AAEA;AAEA;AAOA;AACA;AAKA;AAIA;AAGA;AAGA;AAGA;AACA;;AAEA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;;AAIA;AACA;;AAIA;AAGA;AAGA;;AAEA;AACA;;AAIA;AAGA;;AAEA;AAMA;AAAA;AASA;AACA;AA7HA;;AAiIA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAsBA;;;;;;;;;;;;;;;;;AChMA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA;AAEA;AASA;;AAMA;AAEA;AACA;AACA;AACA;;AAEA;;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AAIA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AAGA;;AAEA;;AAEA;AAEA;AAOA;AACA;AAKA;AAIA;AAGA;AAGA;AAGA;AACA;;AAEA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAIA;AACA;;AAEA;AACA;;AAIA;AAGA;AAGA;AAGA;;AAEA;AAaA;AACA;AAzHA;AA6HA;AAEA;AACA;;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AClNA;;;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtCA;AAAA;AAAA;AAAA;AAAA;AAyCA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAKA;AAdA;AAAA;AAAA;AAAA;AAAA;AA3CA;AA8DA;;AAEA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;ACjFA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACVA;AACA;AACA;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACVA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACNA;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;;AACA;AACA;AACA;;AAEA;;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AACA;;AAEA;AACA;AAEA;;AAGA;;AAEA;AAEA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AAEA;AACA;AAAA;AAAA;;AACA;AACA;AAGA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAGA;;AAEA;AAEA;AAAA;AAAA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AACA;AACA;AAAA;AAAA;AADA;AAGA;AACA;AACA;AACA;;AAEA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AAIA;;AACA;AACA;AACA;;AACA;AACA;AAAA;AAAA;AACA;;AACA;AACA;AACA;;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA","sources":["/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/build/modern-browser-versions.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/build/server-error.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/get-compilation-metadata.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/lib/strip-prefix.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/assets-plugin.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/context-plugin.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/critical-chunk-ids-plugin.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/server-error-plugin.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/ssr-module-scripts-plugin.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/plugins/ssr-plugin.js","/Users/user/Desktop/fusion-tutorial/src/components/root.js","/Users/user/Desktop/fusion-tutorial/src/main.js","webpack://Fusion/?4ee1","/Users/user/Desktop/fusion-tutorial","webpack://Fusion/?5cb1","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/@babel/code-frame/lib/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/ansi-to-html/lib/ansi_to_html.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/node_modules/chalk/source/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-core/dist-node-cjs/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-plugin-react-helmet-async/dist-node-cjs/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-react/dist-node-cjs/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/koa-mount/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/koa-static/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/react/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/react/jsx-dev-runtime.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/source-map-support/source-map-support.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"/Users/user/Desktop/fusion-tutorial/node_modules/vary/index.js\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"assert\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"fs\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"http\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"path\"","/Users/user/Desktop/fusion-tutorial/external commonjs \"url\"","/Users/user/Desktop/fusion-tutorial/webpack/bootstrap","/Users/user/Desktop/fusion-tutorial/webpack/runtime/compat get default export","/Users/user/Desktop/fusion-tutorial/webpack/runtime/define property getters","/Users/user/Desktop/fusion-tutorial/webpack/runtime/hasOwnProperty shorthand","/Users/user/Desktop/fusion-tutorial/webpack/runtime/make namespace object","/Users/user/Desktop/fusion-tutorial/webpack/runtime/publicPath","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/entries/server-public-path.js","/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/entries/server-entry.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n/* eslint-env node */\n\nmodule.exports = {\n  chrome: 61,\n  safari: 12,\n  firefox: 60,\n  android: 61,\n  ios: 12,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nconst path = require('path');\nconst {readFileSync} = require('fs');\nconst {codeFrameColumns} = require('@babel/code-frame');\nconst AnsiToHtml = require('ansi-to-html');\nconst chalk = require('chalk');\n\nfunction parseCodeFrame(error /*: Error */) {\n  const stackLines = (error.stack || '').split('\\n');\n  const secondLine = stackLines.length > 1 ? stackLines[1] : '';\n  const match = secondLine.match(/at (.+) \\((.+):(\\d+):(\\d+)\\)/);\n  const [, functionName, file, line, column] = match || [];\n  if (!(line && column && file)) {\n    return {};\n  }\n  let fileContents;\n  try {\n    fileContents = readFileSync(file, 'utf-8');\n  } catch (e) {\n    // Errors could originate in node internals that do not exist in filesystem\n    return {};\n  }\n  const srcLines = fileContents.split('\\n');\n  const errorLineNumber = parseInt(line) - 1;\n  if (srcLines.length <= errorLineNumber) {\n    // This may happen if sourcemaps reference the wrong file\n    return {};\n  }\n  const whitespace = (srcLines[errorLineNumber] || '').search(/\\S/);\n  const padding = whitespace === -1 ? 0 : whitespace;\n  const codeFrame = codeFrameColumns(\n    fileContents,\n    {\n      start: {\n        line: parseInt(line),\n        column: parseInt(column) + padding,\n      },\n    },\n    {\n      highlightCode: true,\n      linesAbove: 2,\n      linesBelow: 2,\n      message: error.message,\n    }\n  );\n  return {\n    codeFrame,\n    file,\n    line,\n    column,\n    functionName,\n  };\n}\n\nfunction renderTerminalError(error /*: Error */) {\n  const {codeFrame, file, line, column} = parseCodeFrame(error);\n  if (!file) {\n    return chalk.red(error.stack);\n  }\n  const location = chalk.blue(\n    `${path.relative(process.cwd(), file)} ${line}:${column}`\n  );\n  return [location, codeFrame, '', chalk.red(error.stack)].join('\\n');\n}\n\nmodule.exports.renderTerminalError = renderTerminalError;\n\nfunction renderHtmlError(error /*: any */ = {}) {\n  let displayError;\n  let {link} = error;\n  if (error instanceof Error) {\n    displayError = error;\n  } else if (typeof error === 'string') {\n    displayError = new Error(error);\n  } else {\n    displayError = new Error(error.message);\n    displayError.stack = error.stack;\n    displayError.name = error.name;\n  }\n  const {codeFrame, file, line, column, functionName} = parseCodeFrame(error);\n  let displayCodeFrame;\n  if (file) {\n    const ansi = new AnsiToHtml({fg: '#ccc'});\n    const htmlCodeFrame = ansi.toHtml(codeFrame);\n    const relativeFile = path.relative(process.cwd(), file);\n    displayCodeFrame = `\n      <p>\n        <b>${escapeHtml(functionName)}</b>\n        <br>\n        <span style=\"color:rgb(100, 149, 237);\">${relativeFile} ${line}:${column}</span>\n      </p>\n      <pre style=\"background-color: #111;padding: 0 5px;white-space:break-spaces;\">${htmlCodeFrame}</pre>\n    `;\n  }\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>Server error</title>\n        <style>\n          html {\n            background-color: #222;\n            color: white;\n            line-height: 2;\n            font-family: monospace;\n          }\n          a { color: white; }\n          @media (prefers-color-scheme: light) {\n            html {\n              background-color: rgb(240, 233, 231);\n              color: rgb(47, 79, 79);\n            }\n            a { color: rgb(47, 79, 79); }\n          }\n        </style>\n      </head>\n      <body>\n        <div style=\"width:1200px;margin:20px auto;\">\n          <h1 style=\"color:rgb(232,59,70);font-size:large;\">${\n            displayError.message\n          }</h1>\n          ${displayCodeFrame ? displayCodeFrame : ''}\n          <pre style=\"white-space:break-spaces;\">${escapeHtml(\n            displayError.stack\n          )}</pre>\n          <p>\n          ${\n            link\n              ? `<br>For help with this error, visit <a target=\"_blank\" href=\"${link}\">this troubleshooting document</a>`\n              : ''\n          }\n          </p>\n        <div>\n      </body>\n    </html>\n  `;\n}\n\nmodule.exports.renderHtmlError = renderHtmlError;\n\nfunction escapeHtml(str = '') {\n  return (str || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\n/*\nThis is where webpack-related things should be defined\n*/\n\n// custom loaders: see build/compiler.js\n// $FlowFixMe\nconst chunkUrlMap = require('__SECRET_BUNDLE_MAP_LOADER__!'); // eslint-disable-line import/no-unresolved, import/no-extraneous-dependencies\n// $FlowFixMe\nconst syncChunks = require('__SECRET_SYNC_CHUNK_IDS_LOADER__!'); // eslint-disable-line import/no-unresolved, import/no-extraneous-dependencies\n\nmodule.exports = () => {\n  return {\n    syncChunks,\n    chunkUrlMap,\n  };\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n/* eslint-env node */\n\nmodule.exports = function stripPrefix(req /*: any */, prefix /*: string */) {\n  if (req.url.indexOf(prefix) === 0) {\n    req.url = req.url.slice(prefix.length);\n    if (req.url === '' || req.url.indexOf('?') === 0) {\n      req.url = `/${req.url}`;\n    }\n  }\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n/*::\nimport type {AssetsDepsType, AssetsType} from './types.js';\n*/\nimport {createPlugin, getEnv, RouteTagsToken} from 'fusion-core';\n\n// $FlowFixMe\nimport {chunks} from '__SECRET_CHUNK_MANIFEST_LOADER__!'; // eslint-disable-line\n\nimport path from 'path';\nimport mount from 'koa-mount';\nimport serve from 'koa-static';\nimport vary from 'vary';\n\nexport default function (dir /*: string */) {\n  /* eslint-disable-next-line */\n  return createPlugin/*:: <AssetsDepsType, AssetsType> */(\n    {\n      deps: {\n        RouteTags: RouteTagsToken,\n      },\n      middleware: ({RouteTags}) => {\n        const {baseAssetPath, env, dangerouslyExposeSourceMaps} = getEnv();\n        const denyList = new Set();\n        for (let chunk of chunks.values()) {\n          if (!__DEV__ && !dangerouslyExposeSourceMaps) {\n            // Add sourcemaps to static asset denylist\n            denyList.add(`/${path.basename(chunk)}.map`);\n          }\n        }\n\n        const assetMiddleware = serve(\n          path.resolve(dir, `.fusion/dist/${env}/client`),\n          {\n            // setting defer here tells the `serve` middleware to `await next` first before\n            // setting the response. This allows composition with user middleware\n            defer: true,\n            setHeaders: (res) => {\n              if (!__DEV__) {\n                res.setHeader('Cache-Control', 'public, max-age=31536000');\n              }\n              res.setHeader('Timing-Allow-Origin', '*');\n\n              vary(res, 'Accept-Encoding');\n            },\n          }\n        );\n\n        return mount(baseAssetPath, (ctx, next) => {\n          RouteTags.from(ctx).name = 'static_asset';\n          if (denyList.has(ctx.url)) {\n            return next();\n          }\n          return assetMiddleware(ctx, next);\n        });\n      },\n    }\n  );\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\n/*\nThis is where new ctx properties should be initialized\n*/\n\n/*::\nimport type {ContextDepsType, ContextType} from './types';\n*/\nconst getCompilationMetaData = require('../get-compilation-metadata.js');\nconst {createPlugin} = require('fusion-core');\n\n/* eslint-disable-next-line */\nexport default createPlugin/*:: <ContextDepsType, ContextType> */(\n  {\n    middleware: () => {\n      const compilationMetaData = getCompilationMetaData();\n      return function middleware(ctx, next) {\n        // webpack-related things\n        ctx.syncChunks = compilationMetaData.syncChunks;\n        ctx.chunkUrlMap = compilationMetaData.chunkUrlMap;\n        return next();\n      };\n    },\n  }\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\n/*::\nimport type {CriticalChunkIdsDepsType, CriticalChunkIdsType} from './types.js';\n*/\nimport {createPlugin, memoize} from 'fusion-core';\n\n// $FlowFixMe\nimport {initialChunkIds} from '__SECRET_CHUNK_MANIFEST_LOADER__!'; // eslint-disable-line\n\n/* eslint-disable-next-line */\nexport default createPlugin/*:: <CriticalChunkIdsDepsType, CriticalChunkIdsType> */(\n  {\n    provides: () => {\n      return {\n        from: memoize(() => {\n          const chunkIds = new Set();\n          for (const chunkId of initialChunkIds) {\n            chunkIds.add(chunkId);\n          }\n          return chunkIds;\n        }),\n      };\n    },\n  }\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\n/*::\nimport type {ServerErrorDepsType, ServerErrorType} from './types.js';\n*/\n\nimport serverError from '../build/server-error';\nimport {createPlugin} from 'fusion-core';\n\n/* eslint-disable-next-line */\nexport default createPlugin/*:: <ServerErrorDepsType, ServerErrorType> */(\n  {\n    middleware: () =>\n      async function middleware(ctx, next) {\n        try {\n          await next();\n        } catch (err) {\n          ctx.status = err.statusCode || err.status || 500;\n          ctx.body = serverError.renderHtmlError(err);\n        }\n      },\n  }\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n/* eslint-env node */\n/* global __webpack_public_path__ */\n\nimport {\n  createPlugin,\n  escape,\n  consumeSanitizedHTML,\n  CriticalChunkIdsToken,\n  RoutePrefixToken,\n  getEnv,\n} from 'fusion-core';\n\nimport {\n  chunks,\n  runtimeChunkIds,\n  initialChunkIds, // $FlowFixMe\n} from '__SECRET_CHUNK_MANIFEST_LOADER__!'; // eslint-disable-line\n\n/*::\nimport type {SSRBodyTemplateDepsType, SSRBodyTemplateType} from './types.js';\ndeclare var __webpack_public_path__: string;\n*/\n\n/* eslint-disable-next-line */\nexport const SSRModuleScriptsBodyTemplate = createPlugin/*:: <SSRBodyTemplateDepsType,SSRBodyTemplateType> */(\n    {\n      deps: {\n        criticalChunkIds: CriticalChunkIdsToken.optional,\n        routePrefix: RoutePrefixToken.optional,\n      },\n      provides: ({criticalChunkIds, routePrefix}) => {\n        const {dangerouslyExposeSourceMaps} = getEnv();\n        return (ctx) => {\n          const {htmlAttrs, bodyAttrs, title, head, body} = ctx.template;\n          const safeAttrs = Object.keys(htmlAttrs)\n            .map((attrKey) => {\n              return ` ${escape(attrKey)}=\"${escape(htmlAttrs[attrKey])}\"`;\n            })\n            .join('');\n\n          const safeBodyAttrs = Object.keys(bodyAttrs)\n            .map((attrKey) => {\n              return ` ${escape(attrKey)}=\"${escape(bodyAttrs[attrKey])}\"`;\n            })\n            .join('');\n\n          const safeTitle = escape(title);\n          // $FlowFixMe\n          const safeHead = head.map(consumeSanitizedHTML).join('');\n          // $FlowFixMe\n          const safeBody = body.map(consumeSanitizedHTML).join('');\n\n          const coreGlobals = [\n            `<script nonce=\"${ctx.nonce}\">`,\n            `window.performance && window.performance.mark && window.performance.mark('firstRenderStart');`,\n            routePrefix && `__ROUTE_PREFIX__ = ${JSON.stringify(routePrefix)};`,\n            `__FUSION_ASSET_PATH__ = ${JSON.stringify(\n              __webpack_public_path__\n            )};`, // consumed in src/entries/client-public-path.js\n            `__NONCE__ = ${JSON.stringify(ctx.nonce)}`, // consumed in src/entries/client-public-path.js\n            `</script>`,\n          ]\n            .filter(Boolean)\n            .join('');\n\n          const tokenCriticalChunkIds = criticalChunkIds\n            ? criticalChunkIds.from(ctx)\n            : new Set();\n\n          const allCriticalChunkIds = new Set([\n            ...initialChunkIds,\n            // For now, take union of both ctx and token\n            ...ctx.preloadChunks,\n            ...tokenCriticalChunkIds,\n            // runtime chunk must be last script\n            ...runtimeChunkIds,\n          ]);\n\n          const legacyUrls = [];\n          const modernUrls = [];\n\n          for (let chunkId of allCriticalChunkIds) {\n            const url = chunks.get(chunkId);\n            if (url.includes('client-legacy')) {\n              legacyUrls.push(url);\n            } else {\n              modernUrls.push(url);\n            }\n          }\n\n          const devNoModuleLegacyBrowserWarningScript =\n            __DEV__ && legacyUrls.length === 0\n              ? `\n              <script nomodule defer nonce=\"${ctx.nonce}\">\n              document.body.innerHTML='<div style=\"padding:20vmin;font-family:sans-serif;font-size:16px;background:papayawhip\">\n<p>You are using a legacy browser but only the modern bundle has been built (legacy bundles are skipped by default when using <code style=\"display:inline\">fusion dev</code>)\n or when using using <code style=\"display:inline\">fusion build</code> with the --modernBuildOnly flag.</p>\n<p>Please use a modern browser, <pre><code style=\"display:inline\">fusion dev --forceLegacyBuild</code></pre> or\n<pre><code style=\"display:inline\">fusion build</code></pre> with no --modernBuildOnly flag to build the legacy bundle.</p>\n<p>For more information, see the docs on <a href=\"https://github.com/fusionjs/fusion-cli/blob/master/docs/progressively-enhanced-bundles.md\">progressively enhanced bundles</a>.</p>\n</div>';\n              </script>\n              `\n              : '';\n\n          const criticalChunkScripts = [];\n          const preloadHints = [];\n          const crossoriginAttr = process.env.CDN_URL\n            ? ' crossorigin=\"anonymous\"'\n            : '';\n\n          for (let url of modernUrls) {\n            if (!__DEV__ && dangerouslyExposeSourceMaps) {\n              // Use -with-map.js bundles\n              url = addWithMap(url);\n            }\n            preloadHints.push(\n              `<link rel=\"modulepreload\" href=\"${url}\" nonce=\"${ctx.nonce}\"${crossoriginAttr} as=\"script\"/>`\n            );\n            criticalChunkScripts.push(\n              `<script type=\"module\" src=\"${url}\" nonce=\"${ctx.nonce}\"${crossoriginAttr}></script>`\n            );\n          }\n\n          for (let url of legacyUrls) {\n            if (!__DEV__ && dangerouslyExposeSourceMaps) {\n              // Use -with-map.js bundles\n              url = addWithMap(url);\n            }\n            criticalChunkScripts.push(\n              `<script defer nomodule src=\"${url}\" nonce=\"${ctx.nonce}\"${crossoriginAttr}></script>`\n            );\n          }\n\n          return [\n            '<!doctype html>',\n            `<html${safeAttrs}>`,\n            `<head>`,\n            `<meta charset=\"utf-8\" />`,\n            `<title>${safeTitle}</title>`,\n            `${getSafariNoModuleSupportScript({nonce: ctx.nonce})}`,\n            `${devNoModuleLegacyBrowserWarningScript}`,\n            `${preloadHints.join('')}${coreGlobals}${criticalChunkScripts.join(\n              ''\n            )}${safeHead}`,\n            `</head>`,\n            `<body${safeBodyAttrs}>${ctx.rendered}${safeBody}</body>`,\n            '</html>',\n          ].join('');\n        };\n      },\n    }\n  );\n\nfunction addWithMap(url) {\n  if (url.endsWith('-with-map.js')) {\n    return url;\n  } else {\n    return url.replace(/\\.js$/, '-with-map.js');\n  }\n}\n\nfunction getSafariNoModuleSupportScript({nonce} /*: { nonce: string } */) {\n  return [\n    `<script nomodule nonce=\"${nonce}\">`,\n    `(function() {`,\n    `var check = document.createElement('script');`,\n    `if (!('noModule' in check) && 'onbeforeload' in check) {`,\n    `var support = false;`,\n    `document.addEventListener('beforeload', function(e) {`,\n    `if (e.target === check) {`,\n    `support = true;`,\n    `} else if (!e.target.hasAttribute('nomodule') || !support) {`,\n    `return;`,\n    `}`,\n    `e.preventDefault();`,\n    `}, true);`,\n    `check.type = 'module';`,\n    `check.src = '.';`,\n    `document.head.appendChild(check);`,\n    `check.remove();`,\n    `}`,\n    `}());`,\n    `</script>`,\n  ].join('');\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n/* eslint-env node */\n/* global __webpack_public_path__ */\n\nimport {\n  createPlugin,\n  escape,\n  consumeSanitizedHTML,\n  CriticalChunkIdsToken,\n  RoutePrefixToken,\n  getEnv,\n} from 'fusion-core';\n\nimport {\n  chunks,\n  runtimeChunkIds,\n  initialChunkIds, // $FlowFixMe\n} from '__SECRET_CHUNK_MANIFEST_LOADER__!'; // eslint-disable-line\n\nimport modernBrowserVersions from '../build/modern-browser-versions.js';\n\n/*::\nimport type {SSRBodyTemplateDepsType, SSRBodyTemplateType} from './types.js';\ndeclare var __webpack_public_path__: string;\n*/\n\n/* eslint-disable-next-line */\nconst SSRBodyTemplate = createPlugin/*:: <SSRBodyTemplateDepsType,SSRBodyTemplateType> */(\n    {\n      deps: {\n        criticalChunkIds: CriticalChunkIdsToken.optional,\n        routePrefix: RoutePrefixToken.optional,\n      },\n      provides: ({criticalChunkIds, routePrefix}) => {\n        const {dangerouslyExposeSourceMaps} = getEnv();\n        return (ctx) => {\n          const {htmlAttrs, bodyAttrs, title, head, body} = ctx.template;\n          const safeAttrs = Object.keys(htmlAttrs)\n            .map((attrKey) => {\n              return ` ${escape(attrKey)}=\"${escape(htmlAttrs[attrKey])}\"`;\n            })\n            .join('');\n\n          const safeBodyAttrs = Object.keys(bodyAttrs)\n            .map((attrKey) => {\n              return ` ${escape(attrKey)}=\"${escape(bodyAttrs[attrKey])}\"`;\n            })\n            .join('');\n\n          const safeTitle = escape(title);\n          // $FlowFixMe\n          const safeHead = head.map(consumeSanitizedHTML).join('');\n          // $FlowFixMe\n          const safeBody = body.map(consumeSanitizedHTML).join('');\n\n          const coreGlobals = [\n            `<script nonce=\"${ctx.nonce}\">`,\n            `window.performance && window.performance.mark && window.performance.mark('firstRenderStart');`,\n            routePrefix && `__ROUTE_PREFIX__ = ${JSON.stringify(routePrefix)};`,\n            `__FUSION_ASSET_PATH__ = ${JSON.stringify(\n              __webpack_public_path__\n            )};`, // consumed in src/entries/client-public-path.js\n            `__NONCE__ = ${JSON.stringify(ctx.nonce)}`, // consumed in src/entries/client-public-path.js\n            `</script>`,\n          ]\n            .filter(Boolean)\n            .join('');\n\n          const tokenCriticalChunkIds = criticalChunkIds\n            ? criticalChunkIds.from(ctx)\n            : new Set();\n\n          const allCriticalChunkIds = new Set([\n            ...initialChunkIds,\n            // For now, take union of both ctx and token\n            ...ctx.preloadChunks,\n            ...tokenCriticalChunkIds,\n            // runtime chunk must be last script\n            ...runtimeChunkIds,\n          ]);\n\n          const legacyUrls = [];\n          const modernUrls = [];\n\n          for (let chunkId of allCriticalChunkIds) {\n            const url = chunks.get(chunkId);\n            if (url.includes('client-legacy')) {\n              legacyUrls.push(url);\n            } else {\n              modernUrls.push(url);\n            }\n          }\n\n          const isModernBrowser = checkModuleSupport(ctx.useragent.browser);\n\n          if (__DEV__) {\n            if (!isModernBrowser && legacyUrls.length === 0) {\n              return `<!DOCTYPE html>\n<html>\n<head>\n</head>\n<body style=\"padding:20vmin;font-family:sans-serif;font-size:16px;background:papayawhip\">\n<p>You are using a legacy browser but only the modern bundle has been built (legacy bundles are skipped by default when using <code style=\"display:inline\">fusion dev</code>)\n or when using using <code style=\"display:inline\">fusion build</code> with the --modernBuildOnly flag.</p>\n<p>Please use a modern browser, <pre><code style=\"display:inline\">fusion dev --forceLegacyBuild</code></pre> or\n<pre><code style=\"display:inline\">fusion build</code></pre> with no --modernBuildOnly flag to build the legacy bundle.</p>\n<p>For more information, see the docs on <a href=\"https://github.com/fusionjs/fusion-cli/blob/master/docs/progressively-enhanced-bundles.md\">progressively enhanced bundles</a>.</p>\n</body>\n</html>`;\n            }\n          }\n\n          const criticalChunkUrls =\n            isModernBrowser || legacyUrls.length === 0\n              ? modernUrls\n              : legacyUrls;\n          let criticalChunkScripts = [];\n          let preloadHints = [];\n\n          for (let url of criticalChunkUrls) {\n            if (!__DEV__ && dangerouslyExposeSourceMaps) {\n              // Use -with-map.js bundles\n              url = addWithMap(url);\n            }\n            const crossoriginAttr = process.env.CDN_URL\n              ? ' crossorigin=\"anonymous\"'\n              : '';\n            preloadHints.push(\n              `<link rel=\"preload\" href=\"${url}\" nonce=\"${ctx.nonce}\"${crossoriginAttr} as=\"script\"/>`\n            );\n            criticalChunkScripts.push(\n              `<script defer src=\"${url}\" nonce=\"${ctx.nonce}\"${crossoriginAttr}></script>`\n            );\n          }\n\n          return [\n            '<!doctype html>',\n            `<html${safeAttrs}>`,\n            `<head>`,\n            `<meta charset=\"utf-8\" />`,\n            `<title>${safeTitle}</title>`,\n            `${preloadHints.join('')}${coreGlobals}${criticalChunkScripts.join(\n              ''\n            )}${safeHead}`,\n            `</head>`,\n            `<body${safeBodyAttrs}>${ctx.rendered}${safeBody}</body>`,\n            '</html>',\n          ].join('');\n        };\n      },\n    }\n  );\n\nexport {SSRBodyTemplate};\n\nconst embeddedBrowserVersions = {\n  ios_webkit: 605, // mobile safari v13\n};\n\n/*\nEdge must get transpiled classes due to:\n- https://github.com/Microsoft/ChakraCore/issues/5030\n- https://github.com/Microsoft/ChakraCore/issues/4663\n- https://github.com/babel/babel/issues/8019\nRather than transpile classes in the modern bundles, Edge should be forced on the slow path\n\nSafari 10.1 and 11 have some ES6 bugs:\n- https://github.com/mishoo/UglifyJS2/issues/1753\n- https://github.com/mishoo/UglifyJS2/issues/2344\n- https://github.com/terser-js/terser/issues/117\nRather than enable terser workarounds that reduces minification for compliant browsers,\nSafari 10.1 and 11 should be treated as legacy.\n*/\nfunction checkModuleSupport({name, version}) {\n  if (typeof version !== 'string') {\n    return false;\n  }\n  if (name === 'Chrome' || name === 'Chrome Headless' || name === 'Chromium') {\n    if (majorVersion(version) >= modernBrowserVersions.chrome) return true;\n  } else if (name === 'Chrome WebView') {\n    if (majorVersion(version) >= modernBrowserVersions.android) return true;\n  } else if (name === 'WebKit') {\n    if (majorVersion(version) >= embeddedBrowserVersions.ios_webkit)\n      return true;\n  } else if (name === 'Safari') {\n    if (majorVersion(version) >= modernBrowserVersions.safari) return true;\n  } else if (name === 'Mobile Safari') {\n    if (majorVersion(version) >= modernBrowserVersions.ios) return true;\n  } else if (name === 'Firefox') {\n    if (majorVersion(version) >= modernBrowserVersions.firefox) return true;\n  }\n  return false;\n}\n\nfunction majorVersion(version) {\n  return parseInt(version.split('.')[0], 10);\n}\n\nfunction addWithMap(url) {\n  if (url.endsWith('-with-map.js')) {\n    return url;\n  } else {\n    return url.replace(/\\.js$/, '-with-map.js');\n  }\n}\n","import React, {useState} from 'react';\n\nconst Root = () => {\n    const [todos, setTodos] = useState([]);\n    const [input, setInput] = useState('');\n\n    function keyDownHandler(e){\n        if(e.key === 'Enter'){\n            setInput('');\n            setTodos(prev => [...prev,input])\n        }\n    }\n\n    function changeHandler(e){\n        setInput(e.currentTarget.value)\n    }\n    return (\n        <>\n        <style>\n        {\n            `\n            body{\n                background-color: #f5f5f5;\n                front: 24x 'Helvetica Neue', Helvetica, Arial, sans-serif;\n            }\n            h1{\n                color: rgba(175, 47, 47, 0.15);\n                font-size: 100px;\n                font-weight: 100;\n                text-align:center;\n            }\n            .container {\n                background:#ffffff;\n                border: 1px solid #ededed;\n                margin: 0 auto;\n                width: 550px;\n            }\n            input {\n                border:none;\n                font-size:24px;\n                font-weight: 300;\n                padding:15px;\n                width: 520px;\n            }\n            input::placeholder {\n                color: #e6e6e6;\n                font-style:italic;\n                font-weight:100;\n            }\n            .todo{\n                border-top:1px solid #ededed;\n                padding: 15px;\n            }\n            .todo-text {\n                font-weight: 300;\n            }\n            `\n        }\n    </style>\n            <h1>todos</h1>\n            <div className='container'>\n                <input onChange={changeHandler} \n                onKeyDown={keyDownHandler}\n                placeholder='What needs to be done?'\n                value={input}\n                type='text'\n                ></input>\n                {\n                    todos.map( item=> {\n                        return <div className='todo'>\n                            <div className='todo-text'>\n                                {item}\n                            </div>\n                        </div>\n                    })\n                }\n            </div>\n        </>\n    )\n}\n\nexport default <Root />;","import App from 'fusion-react';\nimport Root from './components/root';\nimport HelmetPlugin from 'fusion-plugin-react-helmet-async';\n\n\nexport default async function start(){\n    // const root = <div>Hello World</div>\n    const app = new App(Root);\n    app.register(HelmetPlugin)\n    return app;\n}","export const chunks = new Map([[\"main\", __webpack_public_path__ + \"client-main.js\"], [\"runtime\", __webpack_public_path__ + \"client-runtime.js\"], [\"vendor\", __webpack_public_path__ + \"client-vendor.js\"]]);\nexport const runtimeChunkIds = new Set([\"runtime\"]);\nexport const initialChunkIds = new Set([\"main\",\"vendor\"]);","module.exports = new Map(\n    [[\"main\",[[\"es5\",\"client-main.js\"]]],[\"runtime\",[[\"es5\",\"client-runtime.js\"]]],[\"vendor\",[[\"es5\",\"client-vendor.js\"]]]].map(entry => { //[number, Map<string,string>]\n      entry[1] = new Map(\n        entry[1].map(group => {\n          group[1] = __webpack_public_path__ + group[1];\n          return group;\n        })\n      );\n      return entry;\n    })\n  );","module.exports = [\"runtime\",\"vendor\",\"main\"];","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/@babel/code-frame/lib/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/ansi-to-html/lib/ansi_to_html.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-cli/node_modules/chalk/source/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-core/dist-node-cjs/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-plugin-react-helmet-async/dist-node-cjs/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/fusion-react/dist-node-cjs/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/koa-mount/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/koa-static/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/react/index.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/react/jsx-dev-runtime.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/source-map-support/source-map-support.js\");","module.exports = require(\"/Users/user/Desktop/fusion-tutorial/node_modules/vary/index.js\");","module.exports = require(\"assert\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"path\");","module.exports = require(\"url\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n/*::\ndeclare var __webpack_public_path__: string;\n*/\n\nimport assert from 'assert';\nimport {URL} from 'url';\n\nimport {getEnv} from 'fusion-core';\n\nconst {prefix, cdnUrl, dangerouslyExposeSourceMaps} = getEnv();\nif (typeof prefix === 'string' && prefix !== '') {\n  assert(prefix.startsWith('/'), 'ROUTE_PREFIX must start with /');\n}\nif (typeof cdnUrl === 'string' && cdnUrl !== '') {\n  assert(new URL(cdnUrl), 'CDN_URL must be valid absolute URL');\n}\n\nlet assetBasePath = '/_static/';\nif (prefix) {\n  assetBasePath = prefix + assetBasePath;\n}\n\n// eslint-disable-next-line\n__webpack_public_path__ =\n  cdnUrl && !dangerouslyExposeSourceMaps ? cdnUrl + '/' : assetBasePath;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n/* global __webpack_hash__ */\n\n/* eslint-disable import/first */\nimport sourceMapSupport from 'source-map-support';\n\nsourceMapSupport.install();\n\n// $FlowFixMe[cannot-resolve-module]\nimport '__SECRET_I18N_MANIFEST_INSTRUMENTATION_LOADER__!'; // eslint-disable-line\n\nimport http from 'http';\n\nimport BaseApp, {\n  createPlugin,\n  HttpServerToken,\n  RoutePrefixToken,\n  SSRBodyTemplateToken,\n  CriticalChunkIdsToken,\n} from 'fusion-core';\n\nimport CriticalChunkIdsPlugin from '../plugins/critical-chunk-ids-plugin.js';\nimport AssetsFactory from '../plugins/assets-plugin';\nimport ContextPlugin from '../plugins/context-plugin';\nimport ServerErrorPlugin from '../plugins/server-error-plugin';\nimport {SSRBodyTemplate} from '../plugins/ssr-plugin';\nimport {SSRModuleScriptsBodyTemplate} from '../plugins/ssr-module-scripts-plugin';\nimport stripRoutePrefix from '../lib/strip-prefix.js';\n// $FlowFixMe[cannot-resolve-module]\nimport main from '__FUSION_ENTRY_PATH__'; // eslint-disable-line import/no-unresolved\n\nlet prefix = process.env.ROUTE_PREFIX;\nlet AssetsPlugin;\n\nlet server = null;\nconst state = {serve: null};\nfunction getInitialize() {\n  return typeof main === 'function'\n    ? main\n    : () => {\n        throw new Error('App should export a function');\n      };\n}\n\nlet initialReloadOptions;\nexport async function start(\n  {port, dir = '.', useModuleScripts = false} /*: any */\n) {\n  AssetsPlugin = AssetsFactory(dir);\n  // TODO(#21): support https.createServer(credentials, listener);\n  server = http.createServer();\n\n  initialReloadOptions = {useModuleScripts};\n  await reload(initialReloadOptions);\n\n  server.on('request', (req, res) => {\n    if (prefix) stripRoutePrefix(req, prefix);\n    // $FlowFixMe[not-a-function]\n    state.serve(req, res).catch((e) => {\n      // $FlowFixMe[prop-missing]\n      state.app.onerror(e);\n    });\n  });\n\n  return new Promise((resolve) => {\n    server &&\n      server.listen(port, () => {\n        resolve(server);\n      });\n  });\n}\n\nlet prevApp = null;\nasync function reload(\n  {useModuleScripts} /* : { useModuleScripts?: boolean } */\n) {\n  if (prevApp) {\n    await prevApp.cleanup();\n    prevApp = null;\n  }\n\n  const initialize = getInitialize();\n  const app = await initialize();\n  if (!(app instanceof BaseApp)) {\n    throw new Error('Application entry point did not return an App');\n  }\n  reverseRegister(app, ContextPlugin);\n  app.register(AssetsPlugin);\n  app.register(\n    SSRBodyTemplateToken,\n    useModuleScripts ? SSRModuleScriptsBodyTemplate : SSRBodyTemplate\n  );\n  app.register(CriticalChunkIdsToken, CriticalChunkIdsPlugin);\n  if (prefix) {\n    app.register(RoutePrefixToken, prefix);\n  }\n  if (server) {\n    app.register(HttpServerToken, createPlugin({provides: () => server}));\n  }\n  if (__DEV__) {\n    reverseRegister(app, ServerErrorPlugin);\n  }\n  state.serve = app.callback();\n  // $FlowFixMe[prop-missing]\n  state.app = prevApp = app;\n}\n\nfunction reverseRegister(app, token, plugin) {\n  app.register(token, plugin);\n  const entries = Array.from(app.taskMap.entries());\n  entries.unshift(entries.pop());\n  app.taskMap = new Map(entries);\n}\n\nif (module.hot) {\n  let hasFailedUpdate = false;\n\n  // $FlowFixMe[cannot-resolve-name]\n  let latestServerBuildHash = __webpack_hash__;\n  const isUpToDate = () => {\n    return latestServerBuildHash === __webpack_hash__;\n  };\n\n  let needReload = false;\n  let reloadPromise = Promise.resolve();\n  const checkForUpdate = () => {\n    return (\n      module.hot\n        // $FlowFixMe[prop-missing]\n        .check(true)\n        .then(function (updatedModules) {\n          if (updatedModules && updatedModules.length) {\n            console.log('[HMR] Updated modules');\n            updatedModules.forEach(function (m) {\n              // Do not output internal modules\n              if (m.includes('/fusion-cli/')) {\n                return;\n              }\n\n              console.log('[HMR]  - ', m);\n            });\n          }\n\n          if (!isUpToDate()) {\n            return checkForUpdate();\n          }\n\n          if (needReload) {\n            needReload = false;\n\n            const curReloadPromise = (reloadPromise = reloadPromise.then(\n              function () {\n                function skip() {\n                  return curReloadPromise !== reloadPromise || !isUpToDate();\n                }\n\n                if (skip()) {\n                  return false;\n                }\n\n                return reload(initialReloadOptions).then(function () {\n                  return !skip();\n                });\n              }\n            ));\n\n            return curReloadPromise;\n          }\n\n          return true;\n        })\n    );\n  };\n\n  const onProcessMessage = (data) => {\n    if (hasFailedUpdate) {\n      return;\n    }\n\n    if (data.event === 'update') {\n      latestServerBuildHash = data.serverBuildHash;\n\n      // $FlowFixMe[prop-missing]\n      if (module.hot.status() === 'idle') {\n        checkForUpdate()\n          .then((isReady) => {\n            if (!isReady) {\n              return;\n            }\n\n            // $FlowFixMe[not-a-function]\n            process.send({\n              event: 'ready',\n              serverBuildHash: latestServerBuildHash,\n            });\n          })\n          .catch(function (err) {\n            if (hasFailedUpdate) {\n              return;\n            }\n            hasFailedUpdate = true;\n\n            process.off('message', onProcessMessage);\n            process.nextTick(() => {\n              // $FlowFixMe[not-a-function]\n              process.send({event: 'update-failed'});\n            });\n            global.__DEV_RUNTIME_LOG_ERROR__(err);\n          });\n      }\n    }\n  };\n  process.on('message', onProcessMessage);\n\n  const onAcceptReload = () => {\n    // Defer reload until everything is up-to-date\n    needReload = true;\n  };\n\n  module.hot.accept('__FUSION_ENTRY_PATH__', onAcceptReload);\n  module.hot.accept(\n    '__SECRET_I18N_MANIFEST_INSTRUMENTATION_LOADER__!',\n    onAcceptReload\n  );\n  module.hot.accept('../plugins/ssr-plugin.js', onAcceptReload);\n  module.hot.accept('../plugins/ssr-module-scripts-plugin.js', onAcceptReload);\n  module.hot.accept('../plugins/assets-plugin.js', onAcceptReload);\n  module.hot.accept('../plugins/critical-chunk-ids-plugin.js', onAcceptReload);\n  module.hot.accept('../plugins/context-plugin.js', onAcceptReload);\n\n  // $FlowFixMe[prop-missing]\n  module.hot.decline();\n}\n"],"names":[],"sourceRoot":""}